<!DOCTYPE html>
<html>
<head>
    <title>Test Todos los Logins</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        h1 { color: #2563eb; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d1fae5; border-color: #10b981; }
        .error { background: #fee2e2; border-color: #ef4444; }
        .pending { background: #fef3c7; border-color: #f59e0b; }
        button { padding: 10px 20px; margin: 5px; background: #3b82f6; color: white; border: none; cursor: pointer; border-radius: 5px; }
        button:hover { background: #2563eb; }
        button:disabled { background: #9ca3af; cursor: not-allowed; }
        .result { margin: 10px 0; padding: 10px; background: #f9fafb; border-radius: 4px; font-family: monospace; font-size: 12px; }
        .user-card { display: inline-block; margin: 10px; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; min-width: 300px; }
        .user-card.success { border-color: #10b981; background: #ecfdf5; }
        .user-card.error { border-color: #ef4444; background: #fef2f2; }
        .user-card h3 { margin: 0 0 10px 0; color: #1f2937; }
        .user-card p { margin: 5px 0; }
        .status { font-weight: bold; }
        .status.success { color: #10b981; }
        .status.error { color: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Login - Todos los Usuarios</h1>
        
        <div class="test-section">
            <h2>Usuarios a Probar:</h2>
            <button onclick="testAllUsers()">üöÄ Probar Todos los Usuarios</button>
            <button onclick="testRegister()">üìù Probar Registro de Usuario</button>
            <button onclick="clearResults()">üóëÔ∏è Limpiar Resultados</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const users = [
            { email: 'admin@hefesto.local', password: 'Admin2024!', rol: 'Administrador' },
            { email: 'administrativo___entrada_de_datos@hefesto.local', password: 'Datos123', rol: 'Administrativo - Entrada de Datos' },
            { email: 'administrativo___supervisor@hefesto.local', password: 'Super456', rol: 'Administrativo - Supervisor' },
            { email: 'm√©dico___consulta@hefesto.local', password: 'Medico789', rol: 'M√©dico - Consulta' },
            { email: 't√©cnico_del_sistema@hefesto.local', password: 'Tecnico2024', rol: 'T√©cnico del Sistema' },
            { email: 'jefe@hefesto.local', password: 'Jefe2024', rol: 'Jefe de √Årea' },
            { email: 'medico@hefesto.local', password: 'Carlos123', rol: 'Dr. Carlos Mendoza' },
            { email: 'maria.garcia@hefesto.local', password: 'Maria456', rol: 'Mar√≠a Garc√≠a' },
            { email: 'juan.perez@hefesto.local', password: 'Juan789', rol: 'Juan P√©rez' }
        ];

        async function testLogin(email, password) {
            try {
                const response = await fetch('http://localhost:8000/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: data,
                    error: response.ok ? null : (data.message || 'Error desconocido')
                };
            } catch (error) {
                return {
                    success: false,
                    status: 0,
                    data: null,
                    error: error.message
                };
            }
        }

        async function testAllUsers() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>Probando logins...</h2>';
            
            let successCount = 0;
            let errorCount = 0;

            for (const user of users) {
                const result = await testLogin(user.email, user.password);
                
                const cardClass = result.success ? 'success' : 'error';
                const statusClass = result.success ? 'success' : 'error';
                const statusText = result.success ? '‚úÖ LOGIN EXITOSO' : '‚ùå LOGIN FALLIDO';
                
                if (result.success) successCount++;
                else errorCount++;

                const card = `
                    <div class="user-card ${cardClass}">
                        <h3>${user.rol}</h3>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Password:</strong> ${user.password}</p>
                        <p class="status ${statusClass}">${statusText}</p>
                        ${result.success ? `
                            <p><strong>Usuario:</strong> ${result.data.user.name}</p>
                            <p><strong>Rol:</strong> ${result.data.user.rol}</p>
                            <p><strong>Estado:</strong> ${result.data.user.estado}</p>
                            <p><strong>Token:</strong> ${result.data.token.substring(0, 20)}...</p>
                        ` : `
                            <p><strong>Error:</strong> ${result.error}</p>
                            <p><strong>Status:</strong> ${result.status}</p>
                        `}
                    </div>
                `;
                
                resultsDiv.innerHTML += card;
            }

            resultsDiv.innerHTML += `
                <div class="test-section ${successCount === users.length ? 'success' : 'error'}">
                    <h2>üìä Resumen de Pruebas</h2>
                    <p><strong>Total usuarios probados:</strong> ${users.length}</p>
                    <p><strong>‚úÖ Exitosos:</strong> ${successCount}</p>
                    <p><strong>‚ùå Fallidos:</strong> ${errorCount}</p>
                    <p><strong>Tasa de √©xito:</strong> ${((successCount/users.length)*100).toFixed(1)}%</p>
                </div>
            `;
        }

        async function testRegister() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>Probando registro de usuario...</h2>';

            const timestamp = Date.now();
            const newUser = {
                name: `Usuario Test ${timestamp}`,
                email: `test${timestamp}@hefesto.local`,
                password: 'Test123',
                password_confirmation: 'Test123',
                rol: 'Usuario'
            };

            try {
                const response = await fetch('http://localhost:8000/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify(newUser)
                });

                const data = await response.json();
                
                const cardClass = response.ok ? 'success' : 'error';
                const statusClass = response.ok ? 'success' : 'error';
                const statusText = response.ok ? '‚úÖ REGISTRO EXITOSO' : '‚ùå REGISTRO FALLIDO';

                resultsDiv.innerHTML += `
                    <div class="user-card ${cardClass}">
                        <h3>Nuevo Usuario de Prueba</h3>
                        <p><strong>Nombre:</strong> ${newUser.name}</p>
                        <p><strong>Email:</strong> ${newUser.email}</p>
                        <p><strong>Password:</strong> ${newUser.password}</p>
                        <p><strong>Rol:</strong> ${newUser.rol}</p>
                        <p class="status ${statusClass}">${statusText}</p>
                        ${response.ok ? `
                            <p><strong>ID:</strong> ${data.user.id}</p>
                            <p><strong>Estado:</strong> ${data.user.estado}</p>
                            <p><strong>Token:</strong> ${data.token.substring(0, 20)}...</p>
                        ` : `
                            <p><strong>Error:</strong> ${data.message || 'Error desconocido'}</p>
                            <p><strong>Status:</strong> ${response.status}</p>
                            ${data.errors ? `<pre>${JSON.stringify(data.errors, null, 2)}</pre>` : ''}
                        `}
                    </div>
                `;

                if (response.ok) {
                    resultsDiv.innerHTML += `
                        <div class="test-section success">
                            <h3>‚úÖ Registro completado exitosamente</h3>
                            <p>Ahora puedes probar el login con:</p>
                            <p><strong>Email:</strong> ${newUser.email}</p>
                            <p><strong>Password:</strong> ${newUser.password}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="user-card error">
                        <h3>Error de Conexi√≥n</h3>
                        <p class="status error">‚ùå ${error.message}</p>
                    </div>
                `;
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>
